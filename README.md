# SSO 2FA Skipper

<div align="center">

![Logo](extension/images/logo.png)

**同志社大学 Webシングルサインオンの2要素認証を自動化**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Chrome Extension](https://img.shields.io/badge/Chrome-Extension-blue.svg)](https://www.google.com/chrome/)
[![Latest Release](https://img.shields.io/github/v/release/kmch4n/SSO_2FA_Skipper)](https://github.com/kmch4n/SSO_2FA_Skipper/releases/latest)

</div>

---

## 🎯 概要

SSO 2FA Skipperは、同志社大学のWebシングルサインオンシステムにおける2要素認証プロセスを自動化するChrome拡張機能です。画像マトリックス認証を自動で処理することで、ログインの手間を大幅に削減します。

## ⚡ 主な機能

- **ワンクリックログイン**: ボタン一つでSSO認証フロー全体を実行
- **自動ページ遷移**: 認証プロセス中のページ遷移を自動処理
- **セッションタイムアウト後の自動ログイン**: 一定時間経過後のログアウトを検知し、自動的に再ログイン
- **認証情報の安全な保存**: ログイン情報をChromeストレージに保存
- **古いパスワード変更警告の非表示**: 時代遅れのパスワード定期変更警告を非表示化
- **無限ループ防止機能**: 認証エラー時に自動ログインを無効化し、無限試行を防止

## ⚙️ 事前準備

**重要:** この拡張機能を使用する前に、2要素認証の設定を行う必要があります。

1. SSOシステムに手動でログイン
2. 2要素認証設定へ移動
3. 認証方式を**画像マトリックス**に設定
4. 認証画像として**ロゴマーク（三角形アイコン）**を選択
5. **同じ画像を3回クリック**する設定にする

この設定がない場合、拡張機能は正常に動作しません。

## 📦 インストール

### ステップ 1: 拡張機能をダウンロード

**[📥 最新版をダウンロード](https://github.com/kmch4n/SSO_2FA_Skipper/releases/latest)**

1. [リリースページ](https://github.com/kmch4n/SSO_2FA_Skipper/releases/latest)へアクセス
2. 最新版のリリースパッケージをダウンロード
3. ダウンロードしたファイルを解凍

### ステップ 2: Chromeに読み込む

1. Chromeで`chrome://extensions/`を開く
2. 右上の**デベロッパーモード**を有効化
3. **パッケージ化されていない拡張機能を読み込む**をクリック
4. 解凍した`extension`フォルダを選択

### ステップ 3: 認証情報を設定

1. Chromeツールバーの拡張機能アイコンをクリック
2. ポップアップ下部の**Settings**をクリック
3. ログインIDとパスワードを入力
4. **Save**をクリック

## 🚀 使い方

### 手動ログイン

1. 拡張機能アイコンをクリック
2. **Open SSO Page**でログインページを開く
3. **Execute Login**をクリック
4. 拡張機能が自動的に2要素認証を完了

### 自動ログイン

1. 拡張機能ポップアップを開く
2. **Auto Login**トグルスイッチをONにする
3. セッションタイムアウトでログアウトされた際、自動的にログインが実行される

セッションタイムアウト時には`https://idp.doshisha.ac.jp/idp/profile/SAML2/Redirect/SSO`へリダイレクトされますが、自動ログインが有効な場合は手動操作なしで再ログインが完了します。

## 🔒 セキュリティに関する注意

**重要:** この拡張機能は認証情報をChromeの同期ストレージに保存します。信頼できるデバイスで、自分自身のアカウントのみに使用してください。

### 無限ループ防止機能

認証情報が誤っている場合、以下の動作により無限試行を防止します：

1. 認証エラーを検出
2. 自動ログイン機能を自動的に無効化
3. ユーザーにアラートを表示
4. 設定ページで認証情報を修正し、再度トグルをONにするまで自動ログインは実行されない

手動の「Execute Login」ボタンは、エラーメッセージが表示されていても使用可能です。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。詳細は[LICENSE](LICENSE)ファイルをご覧ください。

## ⚖️ 免責事項

このツールは利便性と教育目的で提供されています。2要素認証システムについては「形式的なもの」として作者が認識していますが、使用は自己責任で行ってください。また、所属機関の利用規約に従うことを確認してください。

本ツールの使用によって生じたいかなるセキュリティ上の問題や不利益についても、作者は一切の責任を負いません。

## 🔧 技術詳細

- **Manifest Version**: 3
- **対応ドメイン**: `sso.doshisha.ac.jp`, `idp.doshisha.ac.jp`
- **権限**: storage, activeTab, scripting
- **言語**: JavaScript (ES6+), HTML5, CSS3

## 📝 変更履歴

### v1.1.0 (2025-11-10)
- セッションタイムアウト後の自動ログイン機能を追加
- 認証エラー検出と無限ループ防止機能を実装
- 古いパスワード変更警告を非表示化
- コードのリファクタリングと最適化
- README を完全日本語化

### v1.0.0
- 初回リリース
- 基本的な2要素認証自動化機能
